# 最終課題 設計資料

vvcnv (video variant converter) — 動画の解像度と品質レベルでファイルサイズをクロステストし, 知覚画質との最適なバランスを見つけるための動画変換ツール

## 1. アプリケーションの⽬的（解決しようとしている問題の背景など）

### 目的

知覚画質とファイルサイズの最適なバランスを見つけるため

### 背景

私の友達に映像制作をするクリエイターがいる.  彼の作品を Web ポートフォリオとして鑑賞できるようにするために, 彼の作品を Web サイトにアップロードしたいと考えている.  

Web サイトはできるかぎり軽量であるべきだが, 納品用の動画ファイルを載せるとなると, そのファイルは高解像度でビットレートも高く, そのままでは Web サイトに載せるには重すぎる.  
かといって, Adobe Media Encoder などで動画を圧縮するとしても, 数ある書き出しパラメーターを調整して目標のファイルサイズにするのは非常に手間がかかる.
また, 動画の圧縮をしすぎると, ブロックノイズやカラーバンディングなどが現れることで知覚画質が悪化してしまい, クリエイターの意図した作品鑑賞の体験を損なう可能性がある.

そこで, 各書き出しパラメーターの組み合わせで動画を変換できる GUI 付きのツール vvcnv を制作する.  クリエイターは, vvcnv によって書き出された結果を比較し, 妥協できる知覚画質とファイルサイズのバランスを見つけることで, 意図した作品鑑賞の体験が実現できるようになる.

vvcnv は Java Swing で GUI を実装し, メインプロセスにて FFmpeg を呼び出して動画変換を行う.  
FFmpeg では, 映像の複雑さによってビットレートを動的に割り当てる CRF (品質レベル) を調整することができ, 固定ビットレートの調整よりも効率的に動画圧縮を行うことができる.

## 2. 機能説明

- ディレクトリの読み取り/書き込み
- 設定値の保存
  - 書き出しプリセット
  - その他 (アプリケーションレベルで) の設定
- FFmpeg CLI の呼び出し/出力結果のパース  
  [`net.bramp.ffmpeg`](https://github.com/bramp/ffmpeg-cli-wrapper) ライブラリの使用予定
- Java Thread による並列処理
  - 動画変換の並列実行
  - GUI の更新
- GUI の実装
  - Java Swing を使用
  - Swing UI デザイナーを使うかは未定

## 3. 画⾯構成説明

### 準備画面

- 対象の動画ファイルを選択 or ドラッグ & ドロップできる
- 出力先のディレクトリを選択 or ドラッグ & ドロップできる
- 書き出しパラメーターの設定
  - 数値指定 or 選択
    - 音声の保持 (T/F)  
      元動画に音声トラックが無い場合は非活性化
    - エンコーディング (H.264 / webM / AV1)
  - クロステストのための最大値/最小値/ステップ数の指定
    - 解像度 (4K–240p)
    - 品質レベル (0–51)
- その他の設定
  - 書き出しパラメーターのプリセット作成/読み込み
  - ドラッグ & ドロップで変換を開始するか
  - 最大並列実行数

### クロステスト画面

- (列: 解像度, 行: 品質レベル) 表形式での...
  - 進捗表示
    - FFmpeg の実行状況をパースしてプログレス表示
  - 結果表示
    - ファイルサイズ (MB)  
      緑から赤のカラースケールで表示  
    - 閲覧と別名保存のボタン

## 4. データの取り扱いなど

- 書き出しパラメーターの保存
- その他 (アプリケーションレベルで) の設定
